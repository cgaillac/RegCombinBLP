% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/loop_EMD.R
\name{loop_EMD}
\alias{loop_EMD}
\title{This function computes the upper and lower bounds of a coefficient using
the 1-dimensional Earth Mover's Distance (EMD) for a specific subset of
data determined by the value of `Xc_x0` and `Xc_y0`. It is used as a helper
function in computing bounds for the BLP method.}
\usage{
loop_EMD(
  k,
  dimXc,
  values,
  eta_d,
  Y,
  w_x,
  w_y,
  Xc_x0,
  Xc_y0,
  Xnc,
  nu_d,
  nu_y,
  dataset = 0
)
}
\arguments{
\item{k}{Integer. Index of the value in `values` for which to compute the bounds.}

\item{dimXc}{Integer. Dimension of the common covariates (Xc).}

\item{values}{Numeric matrix. Unique values of covariates used to define subsets.}

\item{eta_d}{Numeric vector. Residualized independent variable for the subset.}

\item{Y}{Numeric vector. Outcome variable.}

\item{w_x}{Numeric vector. Sample weights for `eta_d`.}

\item{w_y}{Numeric vector. Sample weights for `Y`.}

\item{Xc_x0}{Numeric matrix. Covariate subset for the independent variable.}

\item{Xc_y0}{Numeric matrix. Covariate subset for the outcome variable.}

\item{Xnc}{Numeric matrix. Non-common covariates.}

\item{nu_d}{Numeric vector. Residuals for the independent variable.}

\item{nu_y}{Numeric vector. Residuals for the outcome variable.}

\item{dataset}{Integer (default 0). If 1, uses dataset-specific normalization for probability weights.}
}
\value{
A list of length 2:
\describe{
  \item{[[1]]}{1x2 numeric matrix. Lower and upper EMD-based bounds for the subset.}
  \item{[[2]]}{Numeric scalar. Weight/probability associated with the subset.}
}
}
\description{
This function computes the upper and lower bounds of a coefficient using
the 1-dimensional Earth Mover's Distance (EMD) for a specific subset of
data determined by the value of `Xc_x0` and `Xc_y0`. It is used as a helper
function in computing bounds for the BLP method.
}
\details{
The function selects the subset of observations corresponding to the value
indexed by `k` in `values`. It then computes the 1D EMD between the residualized
independent variable (`nu_d`) and the residualized outcome variable (`nu_y`),
separately for the positive and negative directions. This yields the upper and
lower bounds for the coefficient corresponding to that subset.

It uses the `emd_1d_sorted` function for efficient 1D EMD computation.
}
\examples{
\dontrun{
# Example with simple numeric vectors
eta_d <- c(1.0, 2.0, 3.0, 4.0)
nu_d <- eta_d - mean(eta_d)
Y <- c(2.0, 3.0, 1.0, 5.0)
nu_y <- Y - mean(Y)
Xc_x0 <- matrix(c(1,1,2,2), ncol=1)
Xc_y0 <- matrix(c(1,1,2,2), ncol=1)
w_x <- rep(0.25,4)
w_y <- rep(0.25,4)
values <- matrix(c(1,2), ncol=1)
loop_EMD(1, dimXc=1, values, eta_d, Y, w_x, w_y, Xc_x0, Xc_y0, NULL, nu_d, nu_y)
}
}
